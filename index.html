<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Memorization</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f7f7f7;
    padding: 20px;
    display: flex;
    justify-content: center;
  }
  #app {
    max-width: 800px;
    width: 100%;
    background: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0,0,0,0.2);
  }
  .credit { color: darkgrey; font-size: xx-small; }
  .section {
    font-size: 18px;
    line-height: 1.6;
    white-space: pre-wrap;
    margin-bottom: 20px;
    max-height: 400px;
    overflow-y: auto;
    border: 1px solid #ddd;
    padding: 15px;
    border-radius: 8px;
    word-wrap: break-word;
  }
  button {
    margin: 5px;
    padding: 10px 15px;
    font-size: 16px;
    border: none;
    border-radius: 5px;
    background: #4CAF50;
    color: white;
    cursor: pointer;
  }
  button:hover { background: #45a049; }
  input, textarea {
    padding: 5px;
    font-size: 16px;
    margin-bottom: 10px;
    width: 100%;
  }
</style>
</head>
<body>
<div id="app">
  <h2>Memorization Tool</h2>

  <textarea id="speechInput" placeholder="Paste your speech here..." rows="6"></textarea>
  <input type="number" id="towerSize" placeholder="Words per tower (e.g., 50)">
  <input type="number" id="overlapSize" placeholder="Words to overlap (e.g., 10)">

  <button onclick="init()">Start Memorization</button>
  <button onclick="loadFilipinoResilient()">Practice ‚ÄúFilipino is resilient‚Äù</button>

  <div id="content" class="section"></div>
  <div id="controls"></div>
  <p class="credit">¬© Akenno Masangkay, 2025 ‚Äî <a href="/LICENSE">License</a></p>
</div>

<script>
let sections = [];
let current = 0;
let mode = "read";
let quizWords = [];
let revealed = [];

function loadFilipinoResilient() {
  const text = `Filipino is resilient. Since time immemorial, we have been tested by countless calamities: volcanic eruptions, devastating earthquakes and lahar flows, super typhoons, flash floods, and landslides. Victoriously, we surmounted these ordeals and pains beyond imagination. Instant death of our loved ones claimed by transportation mishaps and natural disasters. Thousands also die in hunger and malnutrition, including ambushes and endless wars in Mindanao. They trampled our basic human rights, such as the right to live. I lost my loving husband, who didn‚Äôt want to join Abu Sayyaf. I lost my only son, who opted to become a military man. We lost our innocent children and women. We lost our homes and properties. Survivors are Filipinos. The wrath of nature and cruel destiny may steal everything from us ‚Äî wealth, properties, and family ‚Äî but Filipinos never give up. Though we are continuously scourged by the test of time, the spirit to survive and to bounce back remains undefeated. I‚Äôm as pliant as a bamboo, for I‚Äôm a man of Earth. My hair may all be blown away by the winds, and my legs may be crippled by the smash of waves. But I will stand and pick up the shattered pieces of myself, and continue to live. Resolute to survive, clothed with inspiration to live not only for my family, but also for my beloved country, Filipinos unite in the midst of crisis, regardless of socio-economic status, tradition, and creed. The world has seen the magnanimous spirit of the Filipinos in crucial times. The gap between the rich and the poor was narrowed. Envy was replaced by sympathy. Hatred was conquered by love. Selfishness was set aside, and saving one‚Äôs life became the ultimate desire. History tells us that the Filipinos have conquered innumerable foes ‚Äî natural and not ‚Äî and shall always strive to champion all odds. Because innate in the Filipino is the will to survive. We may be daunted by the horrible scenes around us, but certainly, we are strengthened by our unwavering faith in God. We have been lauded by many nations in the world for our resiliency during disasters. Others die in saving lives, but only a few realize that we are able to survive because our spirit to fight is deeply anchored in faith ‚Äî that God Almighty will never forsake us. I believe that Filipinos, divided by varied doctrines and cultures, are capable of overcoming any situation if united. Together, we can face any challenge ahead of us. We may stumble and fall, but we will bounce back ‚Äî arms stronger, with vision and faith ‚Äî that after darkness, after pain and suffering, the Filipino survives. The Filipino is resilient.`;
  document.getElementById("speechInput").value = text;
}

// Initialize sections
function init() {
  const speech = document.getElementById("speechInput").value.trim();
  const towerSize = parseInt(document.getElementById("towerSize").value) || 50;
  const overlapSize = parseInt(document.getElementById("overlapSize").value) || 10;

  if (!speech) return alert("Please enter your speech.");

  document.getElementById("speechInput").style.display = "none";
  document.getElementById("towerSize").style.display = "none";
  document.getElementById("overlapSize").style.display = "none";
  document.querySelector('button[onclick="init()"]').style.display = "none";
  document.querySelector('button[onclick="loadFilipinoResilient()"]').style.display = "none";

  const words = speech.split(/\s+/);
  sections = [];
  let start = 0;
  while (start < words.length) {
    let end = start + towerSize;
    const towerWords = words.slice(start, end);
    sections.push(towerWords.join(" "));
    start = end - overlapSize;
  }

  current = 0;
  mode = "read";
  render();
}

// Rendering
function render() {
  const content = document.getElementById("content");
  const controls = document.getElementById("controls");
  controls.innerHTML = "";

  if (!sections.length) { content.textContent = ""; return; }

  if (mode === "read") {
    content.textContent = sections[current];
    controls.innerHTML = `<button onclick="next('blank')">I memorized it</button>${current > 0 ? `<button onclick="back()">Back</button>` : ""}`;
  } else if (mode === "blank") {
    content.textContent = blankify(sections[current]);
    controls.innerHTML = `<button onclick="next('quiz')">Start Quiz</button><button onclick="back()">Back</button>`;
  } else if (mode === "quiz") {
    content.textContent = rebuildQuiz();
    controls.innerHTML = `<input id="answer" placeholder="Type a missing word"><button onclick="check()">Submit</button><button onclick="back()">Back</button>`;
  }
}

// Blank mode
function blankify(text) {
  return text.split(" ").map(maskWord).join(" ");
}
function maskWord(word) {
  let core = word.replace(/[^a-zA-Z]/g, "");
  if (core.length <= 1) return word;
  let masked = core[0] + "_".repeat(core.length - 1);
  return word.replace(core, masked);
}

// Quiz
function startQuiz() {
  quizWords = sections[current].split(/\s+/);
  revealed = quizWords.map(() => false);
  render();
}

function rebuildQuiz() {
  return quizWords.map((w, i) => revealed[i] ? w : maskWord(w)).join(" ");
}

function check() {
  const input = document.getElementById("answer");
  const guesses = input.value.trim().toLowerCase().split(/\s+/);
  let found = false;
  guesses.forEach(guess => {
    quizWords.forEach((w, i) => {
      if (!revealed[i] && w.replace(/[^a-zA-Z]/g, "").toLowerCase() === guess) {
        revealed[i] = true;
        found = true;
      }
    });
  });

  if (found) {
    input.value = "";
    document.getElementById("content").textContent = rebuildQuiz();
    if (revealed.every(r => r)) {
      document.getElementById("controls").innerHTML = `<button onclick="nextSection()">Next Section</button><button onclick="back()">Back</button>`;
    }
  } else alert("Try again!");
  input.focus();
}

// Navigation
function next(newMode) {
  if (newMode) mode = newMode;
  if (mode === "quiz") startQuiz();
  else render();
}

function back() {
  if (mode === "quiz") mode = "blank";
  else if (mode === "blank") mode = "read";
  else if (mode === "read" && current > 0) current--;
  render();
}

function nextSection() {
  if (current < sections.length - 1) {
    current++;
    mode = "read";
    render();
  } else {
    document.getElementById("content").textContent = "üéâ Finished all sections!";
    document.getElementById("controls").innerHTML = "";
  }
}

// Enter key submits
document.addEventListener("keydown", (e) => {
  if (e.key === "Enter") {
    const input = document.getElementById("answer");
    if (input && document.activeElement === input) {
      e.preventDefault();
      check();
    }
  }
});
</script>
</body>
</html>
